#===============================================================================
# DATA CONTRACT: Smart Thermostat Fleet Data
#===============================================================================

dataContractSpecification: 0.9.3
id: urn:datacontract:iot:smart-thermostat-fleet
version: 1.0.0

#───────────────────────────────────────────────────────────────────────────
# 1. OWNERSHIP & GOVERNANCE
#───────────────────────────────────────────────────────────────────────────

info:
  title: "Smart Thermostat Fleet Telemetry"
  description: |
    Temperature and battery telemetry from 10,000 deployed smart thermostats.
    Data received every minute for central analytics platform.
    Critical: Failed sensors send 9999°C, skewing average temperature reports.
  owner: "IoT Platform Team"
  contact:
    name: "IoT Data Engineer"
    email: "iot-platform@company.com"
    slack: "#iot-data"
  classification: internal
  tags: [iot, sensors, temperature, battery, telemetry, home-automation]

#───────────────────────────────────────────────────────────────────────────
# 2. SCHEMA DEFINITION (Logical Contract)
#───────────────────────────────────────────────────────────────────────────

schema:
  type: object
  properties:

    device_id:
      type: string
      description: "Unique identifier for each thermostat device"
      pii: false
      # physical_mapping: dev_id

    temperature_celsius:
      type: number
      minimum: -30
      maximum: 60
      description: |
        Ambient temperature reading in degrees Celsius.
        Valid range: -30°C to 60°C (inclusive).
        Readings outside this range indicate sensor failure or calibration loss.
      pii: false
      # physical_mapping: temp_c

    battery_level:
      type: number
      minimum: 0.0
      maximum: 1.0
      description: |
        Battery charge level as decimal percentage.
        Valid range: 0.0 to 1.0 (inclusive).
        0.0 = dead battery, 1.0 = full charge.
        Values outside range indicate sensor malfunction.
      pii: false
      # physical_mapping: batt_lvl

  required:
    - device_id
    - temperature_celsius
    - battery_level

#───────────────────────────────────────────────────────────────────────────
# 3. SERVICE LEVEL AGREEMENTS (SLAs)
#───────────────────────────────────────────────────────────────────────────

sla:
  freshness:
    threshold: "2 minutes"
    description: "Readings streamed every minute; data available within 2 minutes"
  availability:
    percentage: "99.5%"
    description: "High availability for home automation and energy management"
  retention:
    period: "1 year"
    description: "Historical data for energy usage analysis and device health monitoring"

#───────────────────────────────────────────────────────────────────────────
# 4. DATA QUALITY RULES
#───────────────────────────────────────────────────────────────────────────

quality:

  # Rule 1: Temperature range check
  - name: temperature_range_valid
    type: validity
    expression: "temperature_celsius >= -30 AND temperature_celsius <= 60"
    threshold: "100%"
    enforcement: hard
    description: "Temperature must be between -30°C and 60°C inclusive. Rejects sensor failures (e.g., 9999°C)."

  # Rule 2: Battery level range check
  - name: battery_level_range_valid
    type: validity
    expression: "battery_level >= 0.0 AND battery_level <= 1.0"
    threshold: "100%"
    enforcement: hard
    description: "Battery level must be between 0.0 and 1.0 inclusive. Values like 1.5 or -0.2 indicate malfunction."

  # Rule 3: Device ID not null
  - name: device_id_not_null
    type: completeness
    column: device_id
    threshold: "100%"
    enforcement: hard
    description: "Device ID required to track individual thermostat health"
