#
#===============================================================================
# DATA CONTRACT: Bank Transaction Log for Fraud Detection
#
#===============================================================================

dataContractSpecification: 0.9.3
id: urn:datacontract:fintech:transaction-log
version: 1.0.0

#
#───────────────────────────────────────────────────────────────────────────
# 1. OWNERSHIP & GOVERNANCE
#
#───────────────────────────────────────────────────────────────────────────

info:
  title: "Bank Transaction Log"
  description: |
    Real-time transaction stream for fraud detection system.
    Critical: Legacy system upgrade caused 8-character account IDs instead of required 10 characters.
    This caused silent fraud model failures, missing fraudulent transactions.
    HARD CIRCUIT BREAKER: Invalid account IDs block pipeline immediately.
  owner: "Financial Data Platform Team"
  contact:
    name: "Fraud Analytics Lead"
    email: "fraud-data@bank.com"
    slack: "#fraud-detection-data"
  classification: confidential
  tags: [fintech, transactions, fraud-detection, banking, compliance, pci-dss]

#
#───────────────────────────────────────────────────────────────────────────
# 2. SCHEMA DEFINITION (Logical Contract)
#
#───────────────────────────────────────────────────────────────────────────

schema:
  type: object
  properties:

    account_source_id:
      type: string
      pattern: "^[A-Z0-9]{10}$"
      description: |
        Source account identifier. EXACTLY 10 characters.
        Must contain only uppercase letters (A-Z) and digits (0-9).
        Valid examples: ABCD123456, 1234567890, A1B2C3D4E5
        Invalid: abcd1234 (lowercase/too short), ABC_123456 (underscore), ABC123 (too short)
      pii: true
      # physical_mapping: acct_src

    account_destination_id:
      type: string
      pattern: "^[A-Z0-9]{10}$"
      description: |
        Destination account identifier. EXACTLY 10 characters.
        Must contain only uppercase letters (A-Z) and digits (0-9).
      pii: true
      # physical_mapping: acct_dest

    transaction_timestamp:
      type: string
      format: date-time
      description: "Timestamp of transaction (UTC)"
      pii: false
      # physical_mapping: tx_ts

  required:
    - account_source_id
    - account_destination_id
    - transaction_timestamp

#───────────────────────────────────────────────────────────────────────────
# 3. SERVICE LEVEL AGREEMENTS (SLAs)
#───────────────────────────────────────────────────────────────────────────

sla:
  freshness:
    threshold: "500 milliseconds"
    description: "Real-time fraud detection requires sub-second latency"
  availability:
    percentage: "99.99%"
    description: "Critical uptime for fraud prevention and regulatory compliance"
  retention:
    period: "7 years"
    description: "Retained per banking regulations and audit requirements"

#───────────────────────────────────────────────────────────────────────────
# 4. DATA QUALITY RULES
# HARD CIRCUIT BREAKER: All violations block the pipeline immediately
#───────────────────────────────────────────────────────────────────────────

quality:

  # Rule 1: Source account ID format validation (HARD CIRCUIT BREAKER)
  - name: account_source_id_format
    type: validity
    expression: "REGEXP_LIKE(account_source_id, '^[A-Z0-9]{10}$')"
    threshold: "100%"
    enforcement: hard
    description: |
      HARD CIRCUIT BREAKER: Source account ID must be exactly 10 uppercase alphanumeric characters.
      Any violation (e.g., 8 chars from legacy system) BLOCKS PIPELINE to prevent fraud model failures.

  # Rule 2: Destination account ID format validation (HARD CIRCUIT BREAKER)
  - name: account_destination_id_format
    type: validity
    expression: "REGEXP_LIKE(account_destination_id, '^[A-Z0-9]{10}$')"
    threshold: "100%"
    enforcement: hard
    description: |
      HARD CIRCUIT BREAKER: Destination account ID must be exactly 10 uppercase alphanumeric characters.

  # Rule 3: Transaction timestamp not in future
  - name: transaction_not_future
    type: validity
    expression: "transaction_timestamp <= CURRENT_TIMESTAMP"
    threshold: "100%"
    enforcement: hard
    description: "Transaction timestamp cannot be in the future. Indicates system clock error."

#───────────────────────────────────────────────────────────────────────────
# ENFORCEMENT POLICY
# ──────────────────
# ALL RULES: enforcement: hard (HARD CIRCUIT BREAKER)
# 
# Rationale: Fraudulent transactions cost millions. Invalid account IDs cause
# silent fraud model failures. Any data quality violation must immediately
# block the pipeline rather than logging warnings.
#
# Action on violation: REJECT record, ALERT on-call engineer, HALT ingestion
#───────────────────────────────────────────────────────────────────────────
